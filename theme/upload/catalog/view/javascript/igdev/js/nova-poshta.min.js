$(document).ready(function(){let npCities,npDepartments,novaPoshtaSelected=false;$.ajax({url:"https://api.novaposhta.ua/v2.0/json/",method:"POST",timeout:0,headers:{"Content-Type":"application/json"},data:JSON.stringify({apiKey:$("#accordion #collapse-payment-address").attr("data-np-api-key"),modelName:"Address",calledMethod:"getCities",methodProperties:{Warehouse:"1"}})}).done(function(d){if(d.success){npCities=d.data}});$(document).delegate("input[name='shipping_method']","change",function(){if($("input[name='shipping_method']:checked").val()==="nova_poshta.nova_poshta"){novaPoshtaSelected=true}else{novaPoshtaSelected=false}});$(document).on("DOMSubtreeModified",function(){if($("input[name='shipping_method']:checked").val()==="nova_poshta.nova_poshta"){novaPoshtaSelected=true}else{novaPoshtaSelected=false}});function b(d,e,f){let regEx=new RegExp("^"+f,"i");if(e){let html='<ul class="list-group np-cities-list">';$.each(d,function(g,h){if(h.Area===e){if(f.length){if(h.Description.match(regEx)){html+='<li data-ref="'+h.Ref+'" class="list-group-item">'+h.Description+"</li>"}}else{html+='<li data-ref="'+h.Ref+'" class="list-group-item">'+h.Description+"</li>"}}});html+="</ul>";return html}else{return""}}$(document).delegate(".np-cities-list li","click",function(){$(this).parent().prev("input").val($(this).text());c($(this).attr("data-ref"));$(".np-cities-list").remove()});$(document).delegate("#input-payment-city","click input",function(){if(novaPoshtaSelected){let selectedZone=$("select#input-payment-zone");let inputCity=$(this);if(selectedZone.val()){let zoneId=selectedZone.val(),zoneRef;selectedZone.children("option").each(function(){if($(this).val()===zoneId){zoneRef=$(this).attr("data-zone-code")}});inputCity.parent().css({position:"relative"});if($(".np-cities-list")){$(".np-cities-list").remove()}inputCity.after(b(npCities,zoneRef,inputCity.val()))}}});$(document).delegate("#input-payment-city","focusout",function(){setTimeout(function(){if($(".np-cities-list")){$(".np-cities-list").remove()}},500)});function c(d){$.ajax({url:"https://api.novaposhta.ua/v2.0/json/",method:"POST",timeout:0,headers:{"Content-Type":"application/json"},data:JSON.stringify({apiKey:$("#accordion #collapse-payment-address").attr("data-np-api-key"),modelName:"AddressGeneral",calledMethod:"getWarehouses",methodProperties:{CityRef:d}})}).done(function(e){if(e.success){npDepartments=e.data}})}function a(d,e){let html='<ul class="list-group np-departments-list">';$.each(d,function(f,g){if(e.length){let regEx=new RegExp(e,"gi");if(g.Description.match(regEx)){html+='<li class="list-group-item">'+g.Description+"</li>"}}else{html+='<li class="list-group-item">'+g.Description+"</li>"}});html+="</ul>";return html}$(document).delegate(".np-departments-list li","click",function(){$(this).parent().prev("input").val($(this).text());$(".np-departments-list").remove();npDepartments=undefined});$(document).delegate("#input-payment-address-1","click input",function(){if(npDepartments){let inputAddress=$(this);inputAddress.parent().css({position:"relative"});if($(".np-departments-list")){$(".np-departments-list").remove()}inputAddress.after(a(npDepartments,inputAddress.val()))}});$(document).delegate("#input-payment-address-1","focusout",function(){setTimeout(function(){if($(".np-departments-list")){$(".np-departments-list").remove()}},500)})});